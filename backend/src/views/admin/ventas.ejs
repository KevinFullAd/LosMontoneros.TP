<header class="d-flex justify-content-between align-items-center mb-4 border-bottom pb-2">
    <div>
        <h2 class="h4 mb-0">Ventas</h2>
        <p class="text-muted mb-0">Listado de compras registradas</p>
    </div>
    <button id="btn-nueva-venta" class="btn btn-primary">
        <i class="bi bi-cart-plus me-1"></i>Nueva venta
    </button>
</header>

<section class="card shadow-sm">
    <% if (ventas?.length) { %>
        <table class="table table-striped align-middle mb-0">
            <thead class="table-light">
                <tr>
                    <th>#</th>
                    <th>Cliente</th>
                    <th>Fecha</th>
                    <th>Total</th>
                    <th>Productos</th>
                </tr>
            </thead>
            <tbody>
                <% ventas.forEach(v=> { %>
                    <tr>
                        <td>
                            <%= v.id %>
                        </td>
                        <td>
                            <%= v.clienteNombre || 'N/A' %>
                        </td>
                        <td>
                            <%= new Date(v.fecha).toLocaleDateString() %>
                        </td>
                        <td>$<%= Number(v.total).toFixed(2) %>
                        </td>
                        <td>
                            <ul class="mb-0 small">
                                <% (v.ventaProductos || []).forEach(item=> { %>
                                    <li>
                                        <%= item.producto?.nombre %> x<%= item.cantidad %>
                                    </li>
                                    <% }) %>
                            </ul>
                        </td>
                    </tr>
                    <% }) %>
            </tbody>
        </table>
        <% } else { %>
            <div class="card-body text-center text-muted">
                Aún no hay ventas registradas.
            </div>
            <% } %>
</section>

<script>
    document.getElementById("btn-nueva-venta").addEventListener("click", async () => {
        const r = await Swal.fire({
            title: "Registrar nueva venta",
            text: "¿Deseas ir al formulario de registro de venta?",
            icon: "question",
            showCancelButton: true,
            confirmButtonText: "Sí, continuar",
            cancelButtonText: "Cancelar"
        });
        if (r.isConfirmed) window.location.href = "/admin/ventas/nueva";
    });
</script>